#!/bin/sh
DIR=${0%/*/*/*}
incdir=${DIR}/musl/include
libdir=${DIR}/musl/lib
ldso=/lib/ld-musl-aarch64.so.1
cat > ${DIR}/musl/lib/musl-gcc.specs <<EOF
%rename cpp_options old_cpp_options

*cpp_options:
-nostdinc -isystem $incdir -isystem include%s %(old_cpp_options)

*cc1:
%(cc1_cpu) -nostdinc -isystem $incdir -isystem include%s

*link_libgcc:
-L$libdir -L .%s

*libgcc:
libgcc.a%s %:if-exists(libgcc_eh.a%s)

*startfile:
%{!shared: $libdir/Scrt1.o} $libdir/crti.o crtbeginS.o%s

*endfile:
crtendS.o%s $libdir/crtn.o

*link:
-dynamic-linker $ldso -nostdlib %{shared:-shared} %{static:-static} %{rdynamic:-export-dynamic}

*esp_link:


*esp_options:


*esp_cpp_options:


EOF
exec "${REALGCC:-${DIR}/aarch64-linux-gnu/bin/aarch64-linux-gnu-gcc}" "$@" -specs "${DIR}/musl/lib/musl-gcc.specs"
